# 数据库隔离级别
最近在阅读《高性能MySql》时，文中介绍的隔离级别概念实在让我读起来有些迷惑，特别是不同级别造成的问题有什么区别，实在是很难直接看出来。希望从具体执行过程来看不同的隔离级别。
## 概念介绍
### READ UNCOMMITTED(未提交读)  
> This is the lowest isolation level. In this level, dirty reads are allowed, so one transaction may see not-yet-committed changes made by other transactions  

- 不同事务直接可以看见对方还未提交的修改，也就是说在实际上处于这种隔离级别的事务在进行中做出的任何修改都会直接作用于数据库中。毫无疑问，这是性能最好的，因为没有什么其他多余的机制。但在现实中相比于其他隔离级别，这种隔离级别性能并没有好太多，但坏处明显，首要坏处就是脏读。
    - **脏读**：具体表现为读取某个数据时，读取到了未提交的数据。问题就是在设计上，未提交以为这意味着不应该被读取，实际上，那条事务发生回滚，此时未提交的数据都会被撤销，之前读取的数据就是脏数据。

### READ COMMITTED(提交读)
> This isolation level guarantees that any data read is committed at the moment it is read. Thus it does not allows dirty read. The transaction holds a read or write lock on the current row, and thus prevent other transactions from reading, updating or deleting it.

- 这个隔离级别为了解决脏读问题，设立了一个读数据的机制，即某个数据被读取，那么它是已经被提交的数据，或者是说不可撤销的持久性修改。在这个隔离级别上的显著问题是不可重复读。
    - **不可重复读**：表现是在一个事务执行过程中，可能会出现前后两次读取同一个数据出现不同的结果。原因是在一个事务执行期间，如果另一个事务修改了同一个数据并且提交，那么之后再次读数据就会得到不同的结果。
    
### Repeatable Read(可重复读)
> This is the most restrictive isolation level. The transaction holds read locks on all rows it references and writes locks on all rows it inserts, updates, or deletes. Since other transaction cannot read, update or delete these rows, consequently it avoids non-repeatable read.

- 引用处说明得很清楚，这个隔离级别会对Sql命令`inserts`, `updates`, `deletes`涉及到的所有行*上锁*，就是说这三个命令操作的行从进入事务开始就被该事务锁住，其他事务是无法进行操作的。这个级别的问题就出在命令`select`上，这个命令是没有被上锁的，理论上也很难在事务执行之前上锁，上表锁代价太大。这个问题就是幻读。
    - **幻读**：某个事务执行过程中search了一系列的数据，此时另一个事务插入了一些满足这个搜索条件的数据，此时再次进行搜索，会多得到一些在之前不存在的数据。

### Serializable(序列化)
> This is the Highest isolation level. A serializable execution is guaranteed to be serializable. Serializable execution is defined to be an execution of operations in which concurrently executing transactions appears to be serially executing.

- 就是上面提到的上表锁，此时不存在并发情况，也就不需要解决冲突问题，这种简单粗暴的方法也直接意味着性能堪忧，所以实际上很少使用

### 总结表格

| 隔离级别 | 脏读 | 不可重复读 | 幻读 |
| --- | --- | --- | --- |
| 未提交读 | 可能出现 | 可能出现 | 可能出现 |
| 提交读 | 无 | 可能出现 | 可能出现 |
| 可重复读 | 无 | 无 | 可能出现 |
| 序列化 | 无 | 无 | 无 |

引用文献
> https://www.geeksforgeeks.org/transaction-isolation-levels-dbms/